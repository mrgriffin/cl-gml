#ifndef OPERATOR
#error "must define OPERATOR before including operators"
#endif

OPERATOR(ADD, "add", (
	(((INT, int a), (INT, int b)), (
		push_INT(stack, a + b);
	)), (((FLOAT, float a), (FLOAT, float b)), (
		push_FLOAT(stack, a + b);
	))
))

OPERATOR(SUB, "sub", (
	(((INT, int a), (INT, int b)), (
		push_INT(stack, a - b);
	)), (((FLOAT, float a), (FLOAT, float b)), (
		push_FLOAT(stack, a - b);
	))
))

OPERATOR(ARRAY, "]", (
	(((TOKEN, struct Token token)), (
		ptrdiff_t n = -1;
		while ((stack->top - n)->type != TYPE_MARKER && (stack->top -n)->data.MARKER != MARKER_ARRAY)
			n++;

		pop_n(stack, n);

		__global struct Token *tokens = malloc(heap, n);
		if (tokens) {
			for (size_t i = 0; i < n; ++i)
				tokens[i] = *(stack->top + i + 1);
			push_ARRAY(stack, (struct Array) { tokens, tokens + n });
		}
	))
))

#undef OPERATOR
